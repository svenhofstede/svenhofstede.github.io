<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Your site description"><link rel="shortcut icon" href=https://svenhofstede.com/favicon.ico><link rel=stylesheet href=/css/style.min.css><link rel=canonical href=https://svenhofstede.com/homers-face..-with-a-random-forest/><title>Homer's face.. with a Random Forest!</title></head><body><header id=banner><strong><a href=https://svenhofstede.com/>Sven Hofstede</a></strong><nav><ul><li><a href=/ title=posts>posts</a></li><li><a href=/about/ title=About>About</a></li></ul></nav></header><main id=content><article><header id=post-header><div><time>November 19, 2016</time></div></header><h1 id=classifying-simpsons-characters-in-images>Classifying Simpsons characters in images</h1><h2 id=dataset>Dataset:</h2><p>Many thanks to <a href=https://github.com/jbencina>jbencina</a> for making this dataset available. The dataset is available on github <a href=https://github.com/jbencina/simpsons-image-training-dataset>here</a>:</p><blockquote><p>Collection of 30,693 frames from 65 Simspsons episodes from seasons 3, 4, and 5. Each image is <strong>160x120</strong> pixels.</p><p>One collection (faces-clean-color) contains isolated frames of Homer (n=1,041), Marge (n=444), Lisa (n=358), and Bart (n=645) totalling (n=2,488). These files are labled as {instance_number}_{character_name}.jpg.</p><p>The second collection (unsorted-color) contains 28,205 unsorted frames which can contain backgrounds, characters, text, etc. The two sets are mutually exclusive. This has been broken up into several archives for upload.</p></blockquote><p>This basically gives us 2488 images to train a Simpsons-classifier-model on. Here we go!</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> scipy <span style=color:#f92672>import</span> misc
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> scipy.ndimage <span style=color:#f92672>import</span> find_objects,label
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> matplotlib.pyplot <span style=color:#66d9ef>as</span> plt
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> numpy <span style=color:#66d9ef>as</span> np
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> re
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> pandas <span style=color:#66d9ef>as</span> pd
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> os <span style=color:#f92672>import</span> listdir
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> os.path <span style=color:#f92672>import</span> isfile, join
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> sklearn <span style=color:#f92672>import</span> metrics
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> sklearn.ensemble <span style=color:#f92672>import</span> RandomForestClassifier
</span></span></code></pre></div><h3 id=test-data-split>Test data split</h3><p>I took out 120 images (30 of each character) from the labeled dataset and moved it to a test folder. I&rsquo;ll use this to test my model and see how well it classifies.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>image_path <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;c:/projects/simpsons/faces&#34;</span>
</span></span><span style=display:flex><span>image_path_test <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;c:/projects/simpsons/faces_test&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>image_list <span style=color:#f92672>=</span> [f <span style=color:#66d9ef>for</span> f <span style=color:#f92672>in</span> listdir(image_path) <span style=color:#66d9ef>if</span> isfile(join(image_path, f))]
</span></span><span style=display:flex><span>image_list_test <span style=color:#f92672>=</span> [f <span style=color:#66d9ef>for</span> f <span style=color:#f92672>in</span> listdir(image_path_test) <span style=color:#66d9ef>if</span> isfile(join(image_path_test, f))]
</span></span></code></pre></div><p>I&rsquo;m using regex to extract the target values from the file names.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>regex_pat <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;_([a-z]+).jpg&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>target_array <span style=color:#f92672>=</span> np<span style=color:#f92672>.</span>array([re<span style=color:#f92672>.</span>findall(regex_pat,f)[<span style=color:#ae81ff>0</span>] <span style=color:#66d9ef>for</span> f <span style=color:#f92672>in</span> image_list])
</span></span><span style=display:flex><span>target_array_test <span style=color:#f92672>=</span> np<span style=color:#f92672>.</span>array([re<span style=color:#f92672>.</span>findall(regex_pat,f)[<span style=color:#ae81ff>0</span>] <span style=color:#66d9ef>for</span> f <span style=color:#f92672>in</span> image_list_test])
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>name_list, name_list_counts <span style=color:#f92672>=</span> np<span style=color:#f92672>.</span>unique(target_array, return_counts<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>)
</span></span></code></pre></div><h3 id=equal-spread-on-input-data>Equal spread on input data</h3><p>The initial input was skewed towards Homer and Bart. I evened out the training data.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>at_most <span style=color:#f92672>=</span> min(name_list_counts)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>image_list_by_character <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>image_list_filtered <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> name_list:
</span></span><span style=display:flex><span>    image_list_by_character<span style=color:#f92672>.</span>append([x <span style=color:#66d9ef>for</span> x <span style=color:#f92672>in</span> image_list <span style=color:#66d9ef>if</span> x<span style=color:#f92672>.</span>find(i) <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span>])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> image_list_by_character:
</span></span><span style=display:flex><span>    image_list_filtered <span style=color:#f92672>=</span> image_list_filtered<span style=color:#f92672>+</span>i[<span style=color:#ae81ff>0</span>:at_most]
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>image_list_filtered <span style=color:#f92672>=</span> np<span style=color:#f92672>.</span>array(image_list_filtered)
</span></span></code></pre></div><p>Time to read in the actual images from the new <code>image_list</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>image_array <span style=color:#f92672>=</span> [misc<span style=color:#f92672>.</span>imread(<span style=color:#e6db74>&#39;faces/&#39;</span> <span style=color:#f92672>+</span> f)<span style=color:#f92672>.</span>astype(np<span style=color:#f92672>.</span>uint8) <span style=color:#66d9ef>for</span> f <span style=color:#f92672>in</span> image_list_filtered]
</span></span><span style=display:flex><span>image_array <span style=color:#f92672>=</span> np<span style=color:#f92672>.</span>array(image_array)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>image_array_test <span style=color:#f92672>=</span> [misc<span style=color:#f92672>.</span>imread(<span style=color:#e6db74>&#39;faces_test/&#39;</span> <span style=color:#f92672>+</span> f)<span style=color:#f92672>.</span>astype(np<span style=color:#f92672>.</span>uint8) <span style=color:#66d9ef>for</span> f <span style=color:#f92672>in</span> image_list_test]
</span></span><span style=display:flex><span>image_array_test <span style=color:#f92672>=</span> np<span style=color:#f92672>.</span>array(image_array_test)
</span></span></code></pre></div><p>Need to recalculate the target array as it needs to have less values now.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>target_array <span style=color:#f92672>=</span> np<span style=color:#f92672>.</span>array([re<span style=color:#f92672>.</span>findall(regex_pat,f)[<span style=color:#ae81ff>0</span>] <span style=color:#66d9ef>for</span> f <span style=color:#f92672>in</span> image_list_filtered])
</span></span><span style=display:flex><span>target_array_test <span style=color:#f92672>=</span> np<span style=color:#f92672>.</span>array([re<span style=color:#f92672>.</span>findall(regex_pat,f)[<span style=color:#ae81ff>0</span>] <span style=color:#66d9ef>for</span> f <span style=color:#f92672>in</span> image_list_test])
</span></span></code></pre></div><p>Reshaping the image array to the shape [<em>num_images</em> , <em>num_cols</em>]. In this case the number of images is 1312 in our training set. The number of cols is 57600.</p><p>The images are 120 by 160 pixels. Each image therefore has 19200 pixels. Each pixel is represented by 3 RGB values so each pixel has 3 values by itself. So in total, each image has 57600 columns of data.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>image_array <span style=color:#f92672>=</span> image_array<span style=color:#f92672>.</span>reshape((<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>57600</span>))
</span></span><span style=display:flex><span>image_array_test <span style=color:#f92672>=</span> image_array_test<span style=color:#f92672>.</span>reshape((<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>57600</span>))
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>train_x <span style=color:#f92672>=</span> image_array[:,<span style=color:#ae81ff>0</span>]
</span></span><span style=display:flex><span>train_y <span style=color:#f92672>=</span> target_array
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>rf <span style=color:#f92672>=</span> RandomForestClassifier(n_estimators<span style=color:#f92672>=</span><span style=color:#ae81ff>100</span>)
</span></span><span style=display:flex><span>rf<span style=color:#f92672>.</span>fit(train_x, train_y)
</span></span><span style=display:flex><span>pred <span style=color:#f92672>=</span> rf<span style=color:#f92672>.</span>predict(image_array_test[:,<span style=color:#ae81ff>0</span>])
</span></span><span style=display:flex><span>print(metrics<span style=color:#f92672>.</span>classification_report(target_array_test, pred))
</span></span></code></pre></div><pre><code>             precision    recall  f1-score   support

       bart       0.71      0.80      0.75        30
      homer       0.83      0.80      0.81        30
       lisa       0.79      0.73      0.76        30
      marge       0.93      0.90      0.92        30

avg / total       0.81      0.81      0.81       120
</code></pre><h3 id=intermediate-result>Intermediate result</h3><p>By applying standard RandomForest I end up with a f-score of <strong>81%</strong>.</p><h3 id=next-improvement>Next improvement</h3><p>Use GridSearchCV to find the best configuration for the RandomForest classifier. I was hardcoding the <code>n_estimators</code> on 100 but I was wondering if this shouldn&rsquo;t be optimized automatically. After googling I found GridSearch. I can use this to optimize the settings for my RandomForest. Let&rsquo;s do that!</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> sklearn.grid_search <span style=color:#f92672>import</span> GridSearchCV
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>param_grid <span style=color:#f92672>=</span> { 
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;n_estimators&#39;</span>: [<span style=color:#ae81ff>50</span>, <span style=color:#ae81ff>60</span>, <span style=color:#ae81ff>70</span>, <span style=color:#ae81ff>80</span>, <span style=color:#ae81ff>90</span>, <span style=color:#ae81ff>100</span>, <span style=color:#ae81ff>110</span>, <span style=color:#ae81ff>120</span>]
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>CV_rfc <span style=color:#f92672>=</span> GridSearchCV(estimator<span style=color:#f92672>=</span>rf, param_grid<span style=color:#f92672>=</span>param_grid, cv<span style=color:#f92672>=</span> <span style=color:#ae81ff>5</span>)
</span></span><span style=display:flex><span>CV_rfc<span style=color:#f92672>.</span>fit(train_x, train_y)
</span></span><span style=display:flex><span>print(CV_rfc<span style=color:#f92672>.</span>best_params_)
</span></span></code></pre></div><pre><code>{'n_estimators': 80}
</code></pre><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>rf <span style=color:#f92672>=</span> RandomForestClassifier(n_estimators<span style=color:#f92672>=</span><span style=color:#ae81ff>80</span>)
</span></span><span style=display:flex><span>rf<span style=color:#f92672>.</span>fit(train_x, train_y)
</span></span><span style=display:flex><span>pred <span style=color:#f92672>=</span> rf<span style=color:#f92672>.</span>predict(image_array_test[:,<span style=color:#ae81ff>0</span>])
</span></span><span style=display:flex><span>print(metrics<span style=color:#f92672>.</span>classification_report(target_array_test, pred))
</span></span></code></pre></div><pre><code>             precision    recall  f1-score   support

       bart       0.84      0.87      0.85        30
      homer       0.79      0.87      0.83        30
       lisa       0.89      0.80      0.84        30
      marge       0.93      0.90      0.92        30

avg / total       0.86      0.86      0.86       120
</code></pre><h3 id=intermediate-result-1>Intermediate result</h3><p>After changing the number of estimators from 100 to 80, as suggested by the grid search, the accuracy remained almost the same, maybe slightly better.</p><h3 id=next-improvement-1>Next improvement</h3><p>Currently it&rsquo;s using the entire image to classify. However a large portion of the images are useless background information. Especially the pixels on the left and right edge contain background pixels. Let&rsquo;s try snipping off the edges. I&rsquo;ll reduce the image by 20 pixels from each side.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>trim_image</span>(img):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> img[<span style=color:#ae81ff>20</span>:<span style=color:#f92672>-</span><span style=color:#ae81ff>20</span>]
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>image_array <span style=color:#f92672>=</span> [misc<span style=color:#f92672>.</span>imread(<span style=color:#e6db74>&#39;faces/&#39;</span> <span style=color:#f92672>+</span> f)<span style=color:#f92672>.</span>astype(np<span style=color:#f92672>.</span>uint8) <span style=color:#66d9ef>for</span> f <span style=color:#f92672>in</span> image_list_filtered]
</span></span><span style=display:flex><span>image_array <span style=color:#f92672>=</span> np<span style=color:#f92672>.</span>array(image_array)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>image_array_test <span style=color:#f92672>=</span> [misc<span style=color:#f92672>.</span>imread(<span style=color:#e6db74>&#39;faces_test/&#39;</span> <span style=color:#f92672>+</span> f)<span style=color:#f92672>.</span>astype(np<span style=color:#f92672>.</span>uint8) <span style=color:#66d9ef>for</span> f <span style=color:#f92672>in</span> image_list_test]
</span></span><span style=display:flex><span>image_array_test <span style=color:#f92672>=</span> np<span style=color:#f92672>.</span>array(image_array_test)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>image_array_new <span style=color:#f92672>=</span> np<span style=color:#f92672>.</span>empty((<span style=color:#ae81ff>1312</span>,<span style=color:#ae81ff>120</span>,<span style=color:#ae81ff>120</span>,<span style=color:#ae81ff>3</span>), int)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> i,j <span style=color:#f92672>in</span> enumerate(image_array):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> l,o <span style=color:#f92672>in</span> enumerate(j):
</span></span><span style=display:flex><span>        image_array_new[i][l] <span style=color:#f92672>=</span> trim_image(o)
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>image_array_test_new <span style=color:#f92672>=</span> np<span style=color:#f92672>.</span>empty((len(image_array_test),<span style=color:#ae81ff>120</span>,<span style=color:#ae81ff>120</span>,<span style=color:#ae81ff>3</span>), int)
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> i,j <span style=color:#f92672>in</span> enumerate(image_array_test):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> l,o <span style=color:#f92672>in</span> enumerate(j):
</span></span><span style=display:flex><span>        image_array_test_new[i][l] <span style=color:#f92672>=</span> trim_image(o)
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>image_array_new <span style=color:#f92672>=</span> image_array_new<span style=color:#f92672>.</span>reshape((<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>120</span><span style=color:#f92672>*</span><span style=color:#ae81ff>120</span><span style=color:#f92672>*</span><span style=color:#ae81ff>3</span>))
</span></span><span style=display:flex><span>image_array_test_new <span style=color:#f92672>=</span> image_array_test_new<span style=color:#f92672>.</span>reshape((<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>120</span><span style=color:#f92672>*</span><span style=color:#ae81ff>120</span><span style=color:#f92672>*</span><span style=color:#ae81ff>3</span>))
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>train_x <span style=color:#f92672>=</span> image_array_new[:,<span style=color:#ae81ff>0</span>]
</span></span><span style=display:flex><span>train_y <span style=color:#f92672>=</span> target_array
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>rf <span style=color:#f92672>=</span> RandomForestClassifier(n_estimators<span style=color:#f92672>=</span><span style=color:#ae81ff>80</span>)
</span></span><span style=display:flex><span>rf<span style=color:#f92672>.</span>fit(train_x, train_y)
</span></span><span style=display:flex><span>pred <span style=color:#f92672>=</span> rf<span style=color:#f92672>.</span>predict(image_array_test_new[:,<span style=color:#ae81ff>0</span>])
</span></span><span style=display:flex><span>print(metrics<span style=color:#f92672>.</span>classification_report(target_array_test, pred))
</span></span></code></pre></div><pre><code>             precision    recall  f1-score   support

       bart       0.81      0.83      0.82        30
      homer       0.78      0.83      0.81        30
       lisa       0.89      0.80      0.84        30
      marge       0.93      0.93      0.93        30

avg / total       0.85      0.85      0.85       120
</code></pre><h3 id=result>Result</h3><p>The f-score was slightly better on average but it did not affect the score as much as I expected.</p><h3 id=lesson-learned-1>Lesson learned #1</h3><p>One of my initial models had a strong bias towards predicting Bart and Homer while at the same time Lisa was not getting predicted as often as she should. Turns out the number of input images was skewed. There were many more Homers and Barts then Lisa&rsquo;s.</p><p>I then tried &rsquo;limiting&rsquo; the input images to the minimum number. The character with the least amount of labeled images in the dataset is Lisa who has 338 of them. This means that I might have 1041 images of homer but I&rsquo;m only using 338. The model is being trained on 338 images of Lisa, 338 images of Bart, 338 images of Marge and 338 images of Homer.</p><p>I&rsquo;m not sure if elimating potential training material is best practice but in this case this did cause the model to improve significantly.</p><h3 id=lesson-learned-2>Lesson learned #2</h3><p>Use a package like GridSearch to optimize the settings (for example n_estimators) you provide to the classifier algorithm.</p><h2 id=questions>Questions</h2><ul><li>Is it good to reduce your input to prevent introducing a skew in data?</li><li>Grid search suggested changing the <code>n_estimators</code> to 80. The results were worse of. is this a worthwhile change?</li><li>The results of a RandomForest after different each time. Is this normal?</li></ul><h2 id=final-considerations>Final considerations</h2><p>Another thing I could try to implement is some sort of <strong>face detection</strong> package. I could use this to pinpoint the pixels. This should would probably improve the model even more then simply trimming off pixels from the edges.</p><p>I tried using OpenCV but I was not able to get the install working (Windows). I&rsquo;m my next face-recognition project I will use OpenCV2.</p><p>I could also manually classify some more images so I have more data to train on. I might try that on a later date.</p><p><img src=/img/writings/simpsons_color_files/simpsons_color_31_0.png alt=sim_31></p><h2 id=randomness>Randomness</h2><p>These are the &lsquo;mean&rsquo; images of the characters, based on 20 images.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>bart_images <span style=color:#f92672>=</span> image_list_by_character[<span style=color:#ae81ff>0</span>][<span style=color:#ae81ff>0</span>:<span style=color:#ae81ff>20</span>]
</span></span><span style=display:flex><span>homer_images <span style=color:#f92672>=</span> image_list_by_character[<span style=color:#ae81ff>1</span>][<span style=color:#ae81ff>0</span>:<span style=color:#ae81ff>20</span>]
</span></span><span style=display:flex><span>lisa_images <span style=color:#f92672>=</span> image_list_by_character[<span style=color:#ae81ff>2</span>][<span style=color:#ae81ff>0</span>:<span style=color:#ae81ff>20</span>]
</span></span><span style=display:flex><span>marge_images <span style=color:#f92672>=</span> image_list_by_character[<span style=color:#ae81ff>3</span>][<span style=color:#ae81ff>0</span>:<span style=color:#ae81ff>20</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>bart_array <span style=color:#f92672>=</span> np<span style=color:#f92672>.</span>array([misc<span style=color:#f92672>.</span>imread(<span style=color:#e6db74>&#39;faces/&#39;</span> <span style=color:#f92672>+</span> f, flatten<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>)<span style=color:#f92672>.</span>astype(np<span style=color:#f92672>.</span>uint8) <span style=color:#66d9ef>for</span> f <span style=color:#f92672>in</span> bart_images])
</span></span><span style=display:flex><span>homer_array <span style=color:#f92672>=</span> np<span style=color:#f92672>.</span>array([misc<span style=color:#f92672>.</span>imread(<span style=color:#e6db74>&#39;faces/&#39;</span> <span style=color:#f92672>+</span> f, flatten<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>)<span style=color:#f92672>.</span>astype(np<span style=color:#f92672>.</span>uint8) <span style=color:#66d9ef>for</span> f <span style=color:#f92672>in</span> homer_images])
</span></span><span style=display:flex><span>lisa_array <span style=color:#f92672>=</span> np<span style=color:#f92672>.</span>array([misc<span style=color:#f92672>.</span>imread(<span style=color:#e6db74>&#39;faces/&#39;</span> <span style=color:#f92672>+</span> f, flatten<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>)<span style=color:#f92672>.</span>astype(np<span style=color:#f92672>.</span>uint8) <span style=color:#66d9ef>for</span> f <span style=color:#f92672>in</span> lisa_images])
</span></span><span style=display:flex><span>marge_array <span style=color:#f92672>=</span> np<span style=color:#f92672>.</span>array([misc<span style=color:#f92672>.</span>imread(<span style=color:#e6db74>&#39;faces/&#39;</span> <span style=color:#f92672>+</span> f, flatten<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>)<span style=color:#f92672>.</span>astype(np<span style=color:#f92672>.</span>uint8) <span style=color:#66d9ef>for</span> f <span style=color:#f92672>in</span> marge_images])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>bart_avg <span style=color:#f92672>=</span> np<span style=color:#f92672>.</span>average(bart_array, axis<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>homer_avg <span style=color:#f92672>=</span> np<span style=color:#f92672>.</span>average(homer_array, axis<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>lisa_avg <span style=color:#f92672>=</span> np<span style=color:#f92672>.</span>average(lisa_array, axis<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>marge_avg <span style=color:#f92672>=</span> np<span style=color:#f92672>.</span>average(marge_array, axis<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>f, axarr <span style=color:#f92672>=</span> plt<span style=color:#f92672>.</span>subplots(<span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>2</span>)
</span></span><span style=display:flex><span>axarr[<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>]<span style=color:#f92672>.</span>imshow(bart_avg, cmap<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;Greys_r&#39;</span>)
</span></span><span style=display:flex><span>axarr[<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>]<span style=color:#f92672>.</span>set_title(<span style=color:#e6db74>&#39;Bart&#39;</span>)
</span></span><span style=display:flex><span>axarr[<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>]<span style=color:#f92672>.</span>imshow(homer_avg, cmap<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;Greys_r&#39;</span>)
</span></span><span style=display:flex><span>axarr[<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>]<span style=color:#f92672>.</span>set_title(<span style=color:#e6db74>&#39;Homer&#39;</span>)
</span></span><span style=display:flex><span>axarr[<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>]<span style=color:#f92672>.</span>imshow(lisa_avg, cmap<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;Greys_r&#39;</span>)
</span></span><span style=display:flex><span>axarr[<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>]<span style=color:#f92672>.</span>set_title(<span style=color:#e6db74>&#39;Lisa&#39;</span>)
</span></span><span style=display:flex><span>axarr[<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>]<span style=color:#f92672>.</span>imshow(marge_avg, cmap<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;Greys_r&#39;</span>)
</span></span><span style=display:flex><span>axarr[<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>]<span style=color:#f92672>.</span>set_title(<span style=color:#e6db74>&#39;Marge&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#75715e># Fine-tune figure; hide x ticks for top plots and y ticks for right plots</span>
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>setp([a<span style=color:#f92672>.</span>get_xticklabels() <span style=color:#66d9ef>for</span> a <span style=color:#f92672>in</span> axarr[<span style=color:#ae81ff>0</span>, :]], visible<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>)
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>setp([a<span style=color:#f92672>.</span>get_yticklabels() <span style=color:#66d9ef>for</span> a <span style=color:#f92672>in</span> axarr[:, <span style=color:#ae81ff>1</span>]], visible<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>show()
</span></span></code></pre></div><p><img src=/img/writings/simpsons_color_files/simpsons_color_33_0.png alt=png></p><p>This is me while fitting the models.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>plt<span style=color:#f92672>.</span>imshow(misc<span style=color:#f92672>.</span>imread(<span style=color:#e6db74>&#39;faces/10_bart.jpg&#39;</span>))
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>show()
</span></span></code></pre></div><p><img src=/img/writings/simpsons_color_files/simpsons_color_35_0.png alt=png></p><p>The model was struggling with this image. It misclassifying it as Marge. Obviously due to the blue background which made it think it was showing marge&rsquo;s hair</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>plt<span style=color:#f92672>.</span>imshow(misc<span style=color:#f92672>.</span>imread(<span style=color:#e6db74>&#39;faces_test/1071_homer.jpg&#39;</span>))
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>show()
</span></span></code></pre></div><p><img src=/img/writings/simpsons_color_files/simpsons_color_37_0.png alt=png></p></article></main><footer id=footer></footer></body></html>