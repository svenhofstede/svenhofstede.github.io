<!doctype html><html lang=en-us>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<title>Sven Hofstede</title><meta name=description content="Just stories from my life">
<meta name=viewport content="width=device-width,initial-scale=1">
<link rel=stylesheet href=https://svenhofstede.com/css/bootstrap.min.css>
<link rel=stylesheet href="//fonts.googleapis.com/css?family=Roboto:400,300,700,400italic">
<link rel=stylesheet href=https://svenhofstede.com/css/font-awesome.min.css>
<link rel=stylesheet href=https://svenhofstede.com/css/owl.carousel.css>
<link rel=stylesheet href=https://svenhofstede.com/css/owl.theme.css>
<link href=https://svenhofstede.com/css/style.blue.css rel=stylesheet id=theme-stylesheet><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script>
<script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]-->
<link href=https://svenhofstede.com/css/custom.css rel=stylesheet>
<link rel="shortcut icon" href=https://svenhofstede.com/img/favicon.png>
</head><body>
<div id=all>
<div class=container-fluid>
<div class="row row-offcanvas row-offcanvas-left">
<div id=sidebar class="col-xs-6 col-sm-4 col-md-3 sidebar-offcanvas">
<div class=sidebar-content>
<h1 class=sidebar-heading><a href=https://svenhofstede.com/>Sven Hofstede</a></h1><p class=sidebar-p>I'm a Senior Software Engineer with nearly 10 years of experience. Currently employed as Senior Software Engineer for Nike. Living and working in Belgium.</p><p class=sidebar-p>This webpage is mainly a journal of some cool/fun moments in my life and some writings for ramblings/thoughts.</p><ul class=sidebar-menu>
<li><a href=https://svenhofstede.com/about/>About</a></li><li><a href=https://svenhofstede.com/writings/>Writings</a></li><li><a href=https://svenhofstede.com/book_reviews/>Book reviews</a></li></ul><p class=social>
<a href=https://www.linkedin.com/in/sven-hofstede-864a9656/ data-animate-hover=pulse class=external>
<i class="fa fa-linkedin"></i>
</a>
<a href=https://stackoverflow.com/users/4823240/sven-hofstede data-animate-hover=pulse class=external>
<i class="fa fa-stack-overflow"></i>
</a>
<a href=https://github.com/svenhofstede data-animate-hover=pulse class=external>
<i class="fa fa-github"></i>
</a>
</p></div></div><div class="col-xs-12 col-sm-8 col-md-9 content-column white-background">
<div class="small-navbar visible-xs">
<button type=button data-toggle=offcanvas class="btn btn-ghost pull-left"> <i class="fa fa-align-left"> </i>Menu</button>
<h1 class=small-navbar-heading><a href=https://svenhofstede.com/>Sven Hofstede</a></h1></div><div class=row>
<div class=col-lg-8>
<div class=content-column-content>
<h1>Predicting titanic survivors</h1><h2 id=predicting-titanic-survivors-again>Predicting Titanic Survivors.. again</h2><p>Yes.. I also decided to give the Titanic survival prediction a go. It&rsquo;s probably the go-to starting point for people wanting to learn Machine Learning. Apart from some missing values the dataset itself is pretty clean, the label we are trying to predict &lsquo;makes sense&rsquo;. You can easily reason about what we are going for. If you&rsquo;ve watched the movie you will also have a good idea about what features might be useful ( <em>Woman and children first!</em> ).</p><h2 id=the-code>The Code</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>%</span>matplotlib inline
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> pandas <span style=color:#66d9ef>as</span> pd
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> numpy <span style=color:#66d9ef>as</span> np
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> math
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> csv <span style=color:#66d9ef>as</span> csv
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> sklearn.ensemble <span style=color:#f92672>import</span> RandomForestClassifier
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> re
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> matplotlib.pyplot <span style=color:#66d9ef>as</span> plt
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>train_df <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>read_csv(<span style=color:#e6db74>&#39;train.csv&#39;</span>, header<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>)
</span></span></code></pre></div><h3 id=length-of-the-names>Length of the names</h3><p>Tried length of the name. My thinking was: Richer people tend to have longer, more fancy names. But the model did not improve much at all.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># train_df[&#39;Len&#39;] = train_df[&#39;Name&#39;].map(lambda x: len(x))</span>
</span></span></code></pre></div><p>Creating a new field called Gender to preserve the Sex field.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>train_df[<span style=color:#e6db74>&#39;Gender&#39;</span>] <span style=color:#f92672>=</span> train_df[<span style=color:#e6db74>&#39;Sex&#39;</span>]<span style=color:#f92672>.</span>map( {<span style=color:#e6db74>&#39;female&#39;</span>: <span style=color:#ae81ff>0</span>, <span style=color:#e6db74>&#39;male&#39;</span>: <span style=color:#ae81ff>1</span>} )<span style=color:#f92672>.</span>astype(int)
</span></span></code></pre></div><h3 id=cleaning-up-the-embarked-column>Cleaning up the Embarked column</h3><p>The IF statement just checks if there are any NULL values in the Embarked column. After that it fills in the empty entries (NULL) of the Embarked column with the most occurring value (Mode). Once those gaps are filled in I create a distinct list of the possible values of the Embarked column and store those in <code>Ports</code>. Then I create a dict to store these distinct values and use the dict to convert the Embarked strings to their corresponding int value in the dict.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>if</span> len(train_df<span style=color:#f92672>.</span>Embarked[ train_df<span style=color:#f92672>.</span>Embarked<span style=color:#f92672>.</span>isnull() ]) <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span>:
</span></span><span style=display:flex><span>    train_df<span style=color:#f92672>.</span>loc[train_df<span style=color:#f92672>.</span>Embarked<span style=color:#f92672>.</span>isnull(),<span style=color:#e6db74>&#39;Embarked&#39;</span>] <span style=color:#f92672>=</span> train_df<span style=color:#f92672>.</span>Embarked<span style=color:#f92672>.</span>dropna()<span style=color:#f92672>.</span>mode()<span style=color:#f92672>.</span>values
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Ports <span style=color:#f92672>=</span> list(enumerate(np<span style=color:#f92672>.</span>unique(train_df[<span style=color:#e6db74>&#39;Embarked&#39;</span>])))    <span style=color:#75715e># determine all values of Embarked,</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Ports_dict <span style=color:#f92672>=</span> {name : i <span style=color:#66d9ef>for</span> i, name <span style=color:#f92672>in</span> Ports}
</span></span><span style=display:flex><span>train_df<span style=color:#f92672>.</span>Embarked <span style=color:#f92672>=</span> train_df<span style=color:#f92672>.</span>Embarked<span style=color:#f92672>.</span>map( <span style=color:#66d9ef>lambda</span> x: Ports_dict[x])<span style=color:#f92672>.</span>astype(int)     <span style=color:#75715e># Convert all Embark strings to int</span>
</span></span></code></pre></div><h3 id=add-title-field>Add Title field</h3><p>It read somewhere online that someone&rsquo;s title can contain interesting information. Not only for improving the model directly but also for &lsquo;forecasting&rsquo; the passengers age. Certain titles are only given to people of a certain age group. <em>Master</em> for example is given to a young boy. Another example is the difference between Mrs and Ms.</p><p>I&rsquo;m also converting the string value of the title to an integer.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>names_to_keep <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#39;Miss&#39;</span>,<span style=color:#e6db74>&#39;Mr&#39;</span>,<span style=color:#e6db74>&#39;Mrs&#39;</span>,<span style=color:#e6db74>&#39;Ms&#39;</span>,<span style=color:#e6db74>&#39;Master&#39;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>getTitle</span>(name):
</span></span><span style=display:flex><span>    title <span style=color:#f92672>=</span> re<span style=color:#f92672>.</span>search(<span style=color:#e6db74>&#39;, ([A-Za-z]+).&#39;</span>, name)<span style=color:#f92672>.</span>group(<span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> title <span style=color:#f92672>in</span> names_to_keep:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> title
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#39;Others&#39;</span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>train_df[<span style=color:#e6db74>&#39;Titles&#39;</span>] <span style=color:#f92672>=</span> train_df<span style=color:#f92672>.</span>Name<span style=color:#f92672>.</span>map( <span style=color:#66d9ef>lambda</span> x: getTitle(x))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Titles <span style=color:#f92672>=</span> list(enumerate(np<span style=color:#f92672>.</span>unique(train_df[<span style=color:#e6db74>&#39;Titles&#39;</span>])))
</span></span><span style=display:flex><span>Titles_dict <span style=color:#f92672>=</span> {name : i <span style=color:#66d9ef>for</span> i, name <span style=color:#f92672>in</span> Titles}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>train_df[<span style=color:#e6db74>&#39;TitlesNum&#39;</span>] <span style=color:#f92672>=</span> train_df<span style=color:#f92672>.</span>Titles<span style=color:#f92672>.</span>map( <span style=color:#66d9ef>lambda</span> x: Titles_dict[x])<span style=color:#f92672>.</span>astype(int)
</span></span></code></pre></div><p>&mldr;and now fill in the empty ages with the median of title group</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>mean_ages <span style=color:#f92672>=</span> train_df<span style=color:#f92672>.</span>groupby(<span style=color:#e6db74>&#39;Titles&#39;</span>)[<span style=color:#e6db74>&#39;Age&#39;</span>]<span style=color:#f92672>.</span>mean()<span style=color:#f92672>.</span>to_dict()
</span></span><span style=display:flex><span>train_df<span style=color:#f92672>.</span>loc[train_df<span style=color:#f92672>.</span>Age<span style=color:#f92672>.</span>isnull(),<span style=color:#e6db74>&#39;Age&#39;</span>] <span style=color:#f92672>=</span> train_df<span style=color:#f92672>.</span>Titles<span style=color:#f92672>.</span>map( <span style=color:#66d9ef>lambda</span> x: mean_ages[x] )
</span></span></code></pre></div><h3 id=reading-in-test-data>Reading in test data</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>test_df <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>read_csv(<span style=color:#e6db74>&#39;test.csv&#39;</span>, header<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Create Gender column</span>
</span></span><span style=display:flex><span>test_df[<span style=color:#e6db74>&#39;Gender&#39;</span>] <span style=color:#f92672>=</span> test_df[<span style=color:#e6db74>&#39;Sex&#39;</span>]<span style=color:#f92672>.</span>map( {<span style=color:#e6db74>&#39;female&#39;</span>: <span style=color:#ae81ff>0</span>, <span style=color:#e6db74>&#39;male&#39;</span>: <span style=color:#ae81ff>1</span>} )<span style=color:#f92672>.</span>astype(int)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Fix Embarked column</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> len(test_df<span style=color:#f92672>.</span>Embarked[ test_df<span style=color:#f92672>.</span>Embarked<span style=color:#f92672>.</span>isnull() ]) <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span>:
</span></span><span style=display:flex><span>    test_df<span style=color:#f92672>.</span>Embarked[ test_df<span style=color:#f92672>.</span>Embarked<span style=color:#f92672>.</span>isnull() ] <span style=color:#f92672>=</span> test_df<span style=color:#f92672>.</span>Embarked<span style=color:#f92672>.</span>dropna()<span style=color:#f92672>.</span>mode()<span style=color:#f92672>.</span>values
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Ports <span style=color:#f92672>=</span> list(enumerate(np<span style=color:#f92672>.</span>unique(test_df[<span style=color:#e6db74>&#39;Embarked&#39;</span>])))    <span style=color:#75715e># determine all values of Embarked,</span>
</span></span><span style=display:flex><span>Ports_dict <span style=color:#f92672>=</span> {name : i <span style=color:#66d9ef>for</span> i, name <span style=color:#f92672>in</span> Ports}    
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>test_df<span style=color:#f92672>.</span>Embarked <span style=color:#f92672>=</span> test_df<span style=color:#f92672>.</span>Embarked<span style=color:#f92672>.</span>map( <span style=color:#66d9ef>lambda</span> x: Ports_dict[x])<span style=color:#f92672>.</span>astype(int)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Add Titles column</span>
</span></span><span style=display:flex><span>test_df[<span style=color:#e6db74>&#39;Titles&#39;</span>] <span style=color:#f92672>=</span> test_df<span style=color:#f92672>.</span>Name<span style=color:#f92672>.</span>map( <span style=color:#66d9ef>lambda</span> x: getTitle(x))
</span></span><span style=display:flex><span>test_df[<span style=color:#e6db74>&#39;TitlesNum&#39;</span>] <span style=color:#f92672>=</span> test_df<span style=color:#f92672>.</span>Titles<span style=color:#f92672>.</span>map( <span style=color:#66d9ef>lambda</span> x: Titles_dict[x])<span style=color:#f92672>.</span>astype(int)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Fix Age by adding median of title group </span>
</span></span><span style=display:flex><span>mean_ages <span style=color:#f92672>=</span> test_df<span style=color:#f92672>.</span>groupby(<span style=color:#e6db74>&#39;Titles&#39;</span>)[<span style=color:#e6db74>&#39;Age&#39;</span>]<span style=color:#f92672>.</span>mean()<span style=color:#f92672>.</span>to_dict()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> key, value <span style=color:#f92672>in</span> mean_ages<span style=color:#f92672>.</span>iteritems():
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> math<span style=color:#f92672>.</span>isnan(value):
</span></span><span style=display:flex><span>        mean_ages[key] <span style=color:#f92672>=</span> test_df<span style=color:#f92672>.</span>Age<span style=color:#f92672>.</span>mean()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>test_df<span style=color:#f92672>.</span>loc[test_df<span style=color:#f92672>.</span>Age<span style=color:#f92672>.</span>isnull(),<span style=color:#e6db74>&#39;Age&#39;</span>] <span style=color:#f92672>=</span> test_df<span style=color:#f92672>.</span>Titles<span style=color:#f92672>.</span>map( <span style=color:#66d9ef>lambda</span> x: mean_ages[x] )
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># The isnull check each time to make sure the column has values</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> len(test_df<span style=color:#f92672>.</span>Fare[ test_df<span style=color:#f92672>.</span>Fare<span style=color:#f92672>.</span>isnull() ]) <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span>:
</span></span><span style=display:flex><span>    median_fare <span style=color:#f92672>=</span> np<span style=color:#f92672>.</span>zeros(<span style=color:#ae81ff>3</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> f <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>0</span>,<span style=color:#ae81ff>3</span>):                                              <span style=color:#75715e># loop 0 to 2</span>
</span></span><span style=display:flex><span>        median_fare[f] <span style=color:#f92672>=</span> test_df[ test_df<span style=color:#f92672>.</span>Pclass <span style=color:#f92672>==</span> f<span style=color:#f92672>+</span><span style=color:#ae81ff>1</span> ][<span style=color:#e6db74>&#39;Fare&#39;</span>]<span style=color:#f92672>.</span>dropna()<span style=color:#f92672>.</span>median()
</span></span><span style=display:flex><span>        test_df<span style=color:#f92672>.</span>loc[ (test_df<span style=color:#f92672>.</span>Fare<span style=color:#f92672>.</span>isnull()) <span style=color:#f92672>&amp;</span> (test_df<span style=color:#f92672>.</span>Pclass <span style=color:#f92672>==</span> f<span style=color:#f92672>+</span><span style=color:#ae81ff>1</span> ), <span style=color:#e6db74>&#39;Fare&#39;</span>] <span style=color:#f92672>=</span> median_fare[f]
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>ids <span style=color:#f92672>=</span> test_df[<span style=color:#e6db74>&#39;PassengerId&#39;</span>]<span style=color:#f92672>.</span>values
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>test_df <span style=color:#f92672>=</span> test_df<span style=color:#f92672>.</span>drop([<span style=color:#e6db74>&#39;Name&#39;</span>,<span style=color:#e6db74>&#39;Sex&#39;</span>, <span style=color:#e6db74>&#39;Ticket&#39;</span>, <span style=color:#e6db74>&#39;Cabin&#39;</span>, <span style=color:#e6db74>&#39;PassengerId&#39;</span>,<span style=color:#e6db74>&#39;Titles&#39;</span>], axis<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>) 
</span></span><span style=display:flex><span>train_df <span style=color:#f92672>=</span> train_df<span style=color:#f92672>.</span>drop([<span style=color:#e6db74>&#39;Name&#39;</span>,<span style=color:#e6db74>&#39;Sex&#39;</span>, <span style=color:#e6db74>&#39;Ticket&#39;</span>, <span style=color:#e6db74>&#39;Cabin&#39;</span>, <span style=color:#e6db74>&#39;PassengerId&#39;</span>,<span style=color:#e6db74>&#39;Titles&#39;</span>], axis<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>) 
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>train_data <span style=color:#f92672>=</span> train_df<span style=color:#f92672>.</span>values
</span></span><span style=display:flex><span>test_data <span style=color:#f92672>=</span> test_df<span style=color:#f92672>.</span>values
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>print(<span style=color:#e6db74>&#39;Training...&#39;</span>)
</span></span><span style=display:flex><span>forest <span style=color:#f92672>=</span> RandomForestClassifier(n_estimators<span style=color:#f92672>=</span><span style=color:#ae81ff>100</span>)
</span></span><span style=display:flex><span>forest <span style=color:#f92672>=</span> forest<span style=color:#f92672>.</span>fit( train_data[<span style=color:#ae81ff>0</span>::,<span style=color:#ae81ff>1</span>::], train_data[<span style=color:#ae81ff>0</span>::,<span style=color:#ae81ff>0</span>] )
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#39;Trained&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#39;Predicting...&#39;</span>)
</span></span><span style=display:flex><span>output <span style=color:#f92672>=</span> forest<span style=color:#f92672>.</span>predict(test_data)<span style=color:#f92672>.</span>astype(int)
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#39;Predicted&#39;</span>)
</span></span><span style=display:flex><span>predictions_file <span style=color:#f92672>=</span> open(<span style=color:#e6db74>&#34;forest_prediction.csv&#34;</span>,  <span style=color:#e6db74>&#39;w&#39;</span>)
</span></span><span style=display:flex><span>open_file_object <span style=color:#f92672>=</span> csv<span style=color:#f92672>.</span>writer(predictions_file)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>open_file_object<span style=color:#f92672>.</span>writerow([<span style=color:#e6db74>&#34;PassengerId&#34;</span>,<span style=color:#e6db74>&#34;Survived&#34;</span>])
</span></span><span style=display:flex><span>open_file_object<span style=color:#f92672>.</span>writerows(zip(ids, output))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>predictions_file<span style=color:#f92672>.</span>close()
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#39;Done.&#39;</span>)
</span></span></code></pre></div><pre><code>Training...
Trained
Predicting...
Predicted
Done.
</code></pre><h2 id=the-result>The result</h2><p>After submitting, this predictions came back with a Kaggle score of <strong>0.73206</strong>. Hurray! Unfortunatly an earlier attempt while strictly following a tutorial had a score of <strong>0.77512</strong> so I cannot call it an improvement.</p><h1 id=lessons>Lessons</h1><p>At one point I was struggling to update values in a dataframe. After trying out all kinds of solutions myself I eventually looked for some help online. I found a Slack channel and was helped promptly. My issue was the following:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>train_df[train_df<span style=color:#f92672>.</span>Age<span style=color:#f92672>.</span>isnull()][<span style=color:#e6db74>&#39;Age&#39;</span>] <span style=color:#f92672>=</span> train_df<span style=color:#f92672>.</span>Titles<span style=color:#f92672>.</span>map( <span style=color:#66d9ef>lambda</span> x: mean_ages[x] )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># I got the following error:</span>
</span></span><span style=display:flex><span><span style=color:#75715e># A value is trying to be set on a copy of a slice from a DataFrame.</span>
</span></span></code></pre></div><p>Turns out I was trying to update a copy instead of the original dataframe. Dataframes are sometimes slighly inconsistent when it comes to returning either copies or views. The people in the <a href=https://pythondev.slack.com/messages/data_science/>Slack channel</a> suggested to the <code>.loc</code> function on the dataframe to create a view instead of a copy. This is how the code looks after applying this fix.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>train_df<span style=color:#f92672>.</span>loc[train_df<span style=color:#f92672>.</span>Age<span style=color:#f92672>.</span>isnull(),<span style=color:#e6db74>&#39;Age&#39;</span>] <span style=color:#f92672>=</span> train_df<span style=color:#f92672>.</span>Titles<span style=color:#f92672>.</span>map( <span style=color:#66d9ef>lambda</span> x: mean_ages[x] )
</span></span></code></pre></div><p>More information about this can be <a href=http://pandas.pydata.org/pandas-docs/stable/indexing.html>found here</a></p></div></div></div></div></div></div></div><script src=https://svenhofstede.com/js/jquery.min.js></script>
<script src=https://svenhofstede.com/js/bootstrap.min.js></script>
<script src=https://svenhofstede.com/js/jquery.cookie.js></script>
<script src=https://svenhofstede.com/js/ekko-lightbox.js></script>
<script src=https://svenhofstede.com/js/jquery.scrollTo.min.js></script>
<script src=https://svenhofstede.com/js/masonry.pkgd.min.js></script>
<script src=https://svenhofstede.com/js/imagesloaded.pkgd.min.js></script>
<script src=https://svenhofstede.com/js/owl.carousel.min.js></script>
<script src=https://svenhofstede.com/js/front.js></script>
</body></html>